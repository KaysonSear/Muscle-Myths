## 🤖 Assistant

好的！我现在为您撰写一份详尽的软件需求规格说明书（SRS），专门针对您的肌肉神话健身健美比赛管理系统。

---

# 软件需求规格说明书（SRS）
## 肌肉神话健美比赛管理系统

---

## 文档信息

| 项目 | 内容 |
|------|------|
| **文档标题** | 肌肉神话健美比赛管理系统 - 软件需求规格说明书 |
| **版本** | 1.0 |
| **日期** | 2025年11月21日 |
| **准备人** | 技术团队 |
| **状态** | 草案 - 待开发 |
| **目标AI助手** | Cursor + Gemini 3 Pro |

---

## 目录

1. 引言 [<sup>1</sup>](#1-引言)
2. 整体描述 [<sup>2</sup>](#2-整体描述)
3. 技术栈架构 [<sup>3</sup>](#3-技术栈架构)
4. 系统功能需求 [<sup>4</sup>](#4-系统功能需求)
5. 数据库设计要求 [<sup>5</sup>](#5-数据库设计要求)
6. 非功能性需求 [<sup>6</sup>](#6-非功能性需求)
7. 外部接口需求 [<sup>7</sup>](#7-外部接口需求)
8. 用户界面需求 [<sup>8</sup>](#8-用户界面需求)
9. 附录 [<sup>9</sup>](#9-附录)

---

## 1. 引言

### 1.1 项目背景

**项目名称**：肌肉神话健美比赛管理系统（Muscle Myth Competition Management System - MMCMS）

**问题陈述**：
目前肌肉神话健身健美比赛的技术工作人员使用WPS表格管理选手信息、报名数据和赛事计分。随着赛事规模扩大（2026年计划在多个城市举办十余场赛事），现有工具存在以下局限：
- 无法处理复杂的组别组合逻辑（三级组别嵌套）
- 手动计算报名费用易出错
- 无法实时计分和自动排名
- 数据分散，缺乏统一管理
- 无法进行跨赛事数据分析
- 秩序表调整繁琐，易出错

**解决方案**：
开发一套完整的跨平台管理系统，实现：
- 赛前：选手管理、赛事管理、报名管理、费用自动计算
- 赛中：秩序表可视化编排、实时计分、自动排名
- 赛后：数据分析、成绩导出、多赛事统计

### 1.2 项目目标

1. **提升效率**：自动化报名、计费、计分流程，减少人工操作
2. **降低错误率**：通过系统验证和自动计算，避免人为失误
3. **数据洞察**：提供多维度数据分析，支持决策
4. **用户体验**：跨所有设备无缝使用，界面简洁现代
5. **可扩展性**：支持未来多年、多城市、多赛事规模扩展

### 1.3 目标用户

| 角色 | 描述 | 权限 |
|------|------|------|
| **超级管理员** | 您本人，系统唯一初始管理员 | 所有权限 + 添加/移除其他管理员 |
| **管理员** | 由超级管理员添加的其他工作人员 | 选手管理、赛事管理、计分操作、数据分析（不能管理其他管理员） |

### 1.4 文档约定

- **SHALL/MUST**：强制性需求，必须实现
- **SHOULD**：建议性需求，优先级高
- **MAY/CAN**：可选需求，如时间允许可实现
- **真实组别**：由一级、二级、三级组别组合而成的唯一参赛单元（如"青年传统E"）

---

## 2. 整体描述

### 2.1 产品概述

肌肉神话健美比赛管理系统是一个**全栈Web应用**，配合**跨平台桌面和移动端应用**，为健美比赛提供从报名到成绩发布的全流程数字化管理。

**系统核心特性**：
- 选手信息集中管理，支持跨赛事追踪
- 灵活的三级组别体系，自动组合生成"真实组别"
- 智能费用计算，支持首项/兼项差异化定价
- 可视化秩序表编排，支持拖拽排序
- 实时计分系统，自动去极值、排名、同分高亮
- 多维度数据分析，支持自定义筛选条件
- 响应式设计，适配所有设备

### 2.2 用户需求

| 用户场景 | 需求描述 |
|----------|----------|
| **赛前准备** | 创建赛事、添加选手、为选手报名、查看报名费、购买增值服务 |
| **赛事编排** | 安排出场顺序、合并相邻组别、标记兼项选手、导出秩序表 |
| **赛中计分** | 实时输入裁判评分、自动计算排名、标记退赛选手、识别冠军 |
| **数据分析** | 查看报名统计、性别/年龄分布、组别偏好、人均消费、趋势分析 |
| **成绩发布** | 导出计分表、隐藏敏感信息、公示成绩 |

### 2.3 假设与依赖

**假设**：
1. 管理员熟悉健美比赛规则和组别体系
2. 选手信息在报名时由工作人员录入
3. 裁判人数为1-7人（奇数为佳）
4. 赛事在有稳定网络的场馆举行
5. 未来可能引入小程序供选手自助报名（当前由管理员代为操作）

**依赖**：
1. 稳定的云服务器（用于部署后端和数据库）
2. 现代浏览器支持（Chrome、Safari、Edge、Firefox最新版）
3. 可选：短信服务（如未来启用手机验证码登录）

### 2.4 约束条件

1. **预算约束**：避免使用付费短信服务
2. **时间约束**：2026年赛季前完成开发和测试
3. **技术约束**：使用指定技术栈（见第3章）
4. **合规约束**：保护选手隐私（身份证号等敏感信息可选导出）
5. **性能约束**：支持单场赛事500+选手同时管理

---

## 3. 技术栈架构

### 3.1 架构选型："终极方案"混合架构

根据前期讨论，本项目采用**混合技术栈**，在各自擅长的领域发挥最大优势：

```
┌─────────────────────────────────────────────────────────┐
│                   肌肉神话比赛管理系统                      │
├─────────────────────────────────────────────────────────┤
│  前端 Web (主要界面)                                       │
│  ├─ Next.js 15 (React框架 + 服务端渲染)                  │
│  ├─ React 18 (前端UI库)                                  │
│  ├─ TypeScript 5 (类型安全)                              │
│  └─ TailwindCSS + Shadcn/ui (UI组件库)                   │
├─────────────────────────────────────────────────────────┤
│  移动端 + 桌面端 (未来扩展)                                │
│  └─ Flutter 3.x (Dart语言)                               │
│     ├─ iOS App                                           │
│     ├─ Android App                                       │
│     ├─ Windows Desktop                                   │
│     ├─ macOS Desktop                                     │
│     └─ Linux Desktop                                     │
├─────────────────────────────────────────────────────────┤
│  后端 API                                                 │
│  ├─ Node.js 20+ (JavaScript运行环境)                     │
│  ├─ Express.js 4 (Web框架)                               │
│  ├─ TypeScript 5 (类型安全)                              │
│  └─ REST API (前后端通信)                                │
├─────────────────────────────────────────────────────────┤
│  数据库                                                   │
│  ├─ MongoDB 7+ (NoSQL文档数据库)                         │
│  └─ Mongoose (ODM对象文档映射)                           │
├─────────────────────────────────────────────────────────┤
│  文件存储                                                 │
│  ├─ 云存储 (阿里云OSS / AWS S3 / 本地存储)                │
│  └─ 用于存储裁判头像、赛事封面图                           │
├─────────────────────────────────────────────────────────┤
│  部署 & DevOps                                            │
│  ├─ Docker (容器化)                                      │
│  ├─ 云服务器 (阿里云/腾讯云/AWS)                          │
│  └─ Nginx (反向代理)                                     │
└─────────────────────────────────────────────────────────┘
```

### 3.2 技术栈详细说明

#### 3.2.1 前端 Web（主要开发）

**技术选择**：Next.js + React + TypeScript

**理由**：
- 39.03%的软件项目因需求收集和管理不善而失败，TypeScript的类型系统能提前发现错误
- Next.js提供服务端渲染（SSR），提升首屏加载速度
- React生态成熟，组件丰富，开发效率高
- TypeScript统一前后端语言，减少沟通成本

**核心库**：
- **UI框架**：Shadcn/ui（基于Radix UI的无样式组件库）
- **样式**：TailwindCSS（实用优先的CSS框架）
- **状态管理**：Zustand 或 React Context（轻量级状态管理）
- **表单验证**：React Hook Form + Zod（表单处理 + 模式验证）
- **数据请求**：TanStack Query（React Query，服务端状态管理）
- **表格组件**：TanStack Table（React Table，强大的表格库）
- **拖拽功能**：@dnd-kit（React拖拽库，用于秩序表编排）
- **图表库**：Recharts（基于D3.js的React图表库，用于数据分析饼图）
- **文件导出**：SheetJS (xlsx)（导出Excel文件）
- **日期处理**：date-fns（日期工具库）

#### 3.2.2 后端 API

**技术选择**：Node.js + Express + TypeScript

**理由**：
- 与前端共享TypeScript类型定义，避免API通信断层
- Express轻量级，易于上手和扩展
- Node.js异步I/O适合高并发场景

**核心库**：
- **认证**：jsonwebtoken (JWT令牌认证)
- **密码加密**：bcryptjs（密码哈希）
- **数据验证**：Zod（与前端共享验证逻辑）
- **文件上传**：multer（处理multipart/form-data）
- **日志**：winston（日志记录）
- **环境变量**：dotenv（配置管理）
- **CORS**：cors（跨域资源共享）

#### 3.2.3 数据库

**技术选择**：MongoDB + Mongoose

**理由**：
- 灵活的文档模型，适合复杂的组别嵌套结构
- 无需预定义Schema，易于迭代
- Mongoose提供类型安全的ODM

#### 3.2.4 移动端 + 桌面端（第二阶段开发）

**技术选择**：Flutter 3.x

**理由**：
- 真正的跨平台"一次编写，到处运行"
- 接近原生性能
- UI一致性强，符合"瑞士设计风格"要求
- 可与Web端共享REST API

**开发优先级**：
1. **第一阶段**：完成Web端全部功能（MVP）
2. **第二阶段**：开发Flutter移动端（iOS + Android）
3. **第三阶段**：开发Flutter桌面端（Windows + macOS + Linux）

### 3.3 部署架构

```
用户设备 (浏览器/Flutter App)
          ↓
    [Nginx反向代理]
          ↓
    [Next.js前端服务器] (SSR + 静态资源)
          ↓
    [Express后端API] (REST API)
          ↓
    [MongoDB数据库] (数据存储)
          ↓
    [云存储/本地存储] (图片等文件)
```

---

## 4. 系统功能需求

### 4.1 用户认证与权限管理（模块1）

#### 4.1.1 登录系统

**功能描述**：管理员通过私有Token登录系统。

**需求ID**：FR-AUTH-001

**优先级**：高（MUST）

**详细需求**：
1. **初始状态**：
   - 系统初始化时创建唯一的**超级管理员账户**
   - 超级管理员拥有一个**私有登录Token**（256位随机字符串，系统生成）
   - Token存储在环境变量或安全配置文件中

2. **登录方式**：
   - 管理员在登录页面输入**用户名 + Token**
   - 系统验证Token是否匹配
   - 验证通过后，生成JWT Token（有效期7天），存储在浏览器Cookie/LocalStorage
   - 后续请求通过JWT Token进行身份验证

3. **备选方案（可选，第二阶段）**：
   - 如果未来预算允许，可引入**手机号 + 验证码**登录
   - 使用免费验证码服务（如阿里云短信免费额度）或邮件验证码
   - **当前版本**：仅实现Token登录

**验收标准**：
- 超级管理员可通过Token成功登录
- 其他管理员可通过分配的用户名/密码登录
- 错误Token无法登录，显示错误提示
- JWT Token过期后自动跳转登录页

---

#### 4.1.2 管理员管理

**功能描述**：超级管理员可添加/移除其他管理员。

**需求ID**：FR-AUTH-002

**优先级**：高（MUST）

**详细需求**：
1. **添加管理员**：
   - 超级管理员进入"管理员管理"页面
   - 点击"添加管理员"按钮
   - 输入：姓名、用户名、初始密码
   - 系统自动创建新管理员账户
   - 新管理员使用用户名/密码登录

2. **移除管理员**：
   - 超级管理员可查看所有管理员列表
   - 点击"移除"按钮，确认后删除管理员账户
   - 被移除的管理员无法再登录系统

3. **权限说明**：
   - **超级管理员**：全部权限 + 管理其他管理员
   - **普通管理员**：全部功能权限（选手管理、赛事管理、计分等），但不能添加/移除管理员

**验收标准**：
- 超级管理员可成功添加新管理员
- 新管理员可使用分配的用户名/密码登录
- 超级管理员可移除管理员，被移除的管理员无法登录
- 普通管理员无法访问"管理员管理"页面

---

### 4.2 选手管理（模块2）

#### 4.2.1 选手列表与搜索

**功能描述**：统一管理所有选手信息，支持搜索和筛选。

**需求ID**：FR-ATHLETE-001

**优先级**：高（MUST）

**详细需求**：
1. **选手列表页面**：
   - 系统设立**一级导航入口**："选手管理"
   - 显示所有选手的卡片列表/表格视图
   - 每条记录显示：头像（可选）、姓名、号码牌、性别、手机号、参赛次数

2. **搜索功能**：
   - 支持按**姓名、号码牌、手机号**搜索
   - 实时搜索，输入即筛选

3. **筛选功能**：
   - 支持按**性别、国籍、报名渠道**筛选
   - 支持按**是否尿检**筛选

4. **排序功能**：
   - 支持按**姓名、号码牌、参赛次数**排序

**验收标准**：
- 可查看所有选手列表
- 搜索功能正常，能快速找到目标选手
- 筛选和排序功能正常

---

#### 4.2.2 添加/编辑选手

**功能描述**：添加新选手或编辑现有选手信息。

**需求ID**：FR-ATHLETE-002

**优先级**：高（MUST）

**详细需求**：
1. **添加选手**：
   - 点击"添加选手"按钮
   - 弹出表单，输入以下信息：

   | 字段名 | 类型 | 是否必填 | 说明 |
   |--------|------|----------|------|
   | **姓名** | 文本 | 必填 | 选手真实姓名 |
   | **性别** | 单选 | 必填 | 男/女 |
   | **号码牌** | 数字 | 必填 | 唯一编号（系统可建议下一个可用号码） |
   | **手机号** | 文本 | 必填 | 11位手机号 |
   | **国籍** | 下拉 | 必填 | 中国大陆、中国台湾、中国香港、澳门、其他国家 |
   | **证件类型** | 下拉 | 必填 | 身份证、回乡证、台胞证、护照、其他 |
   | **证件号** | 文本 | 必填 | 证件号码 |
   | **生日** | 日期 | 条件必填 | 如证件类型为身份证，系统自动从证件号提取；否则手动输入 |
   | **年龄** | 数字 | 自动计算 | 根据生日自动计算当前年龄 |
   | **身高** | 数字 | 选填 | 单位：厘米 |
   | **体重** | 数字 | 选填 | 单位：公斤 |
   | **是否尿检** | 复选框 | 必填 | 是/否 |
   | **报名渠道** | 下拉 | 必填 | 小程序、飞书、其他 |
   | **备注** | 文本域 | 选填 | 额外信息 |

2. **编辑选手**：
   - 点击选手卡片/行，进入选手详情页
   - 可修改所有字段（号码牌除外，避免混淆）
   - 保存后更新数据库

3. **身份证号自动解析**：
   - 当证件类型为"身份证"时，系统自动从证件号提取生日和性别
   - 生日格式：YYYYMMDD（从身份证号第7-14位提取）
   - 性别：根据身份证号第17位判断（奇数为男，偶数为女）
   - 年龄：根据生日自动计算

4. **唯一性验证**：
   - 系统为每个选手分配**唯一ID**（UUID或MongoDB ObjectId）
   - 手机号不允许重复（同一人多次参赛使用同一记录）
   - 号码牌在全局范围内不允许重复

**验收标准**：
- 可成功添加新选手，所有必填字段验证通过
- 身份证号自动解析生日和性别正确
- 年龄根据生日实时计算
- 可编辑选手信息并保存
- 手机号重复时显示错误提示

---

#### 4.2.3 选手详情页

**功能描述**：查看选手的完整信息和参赛历史。

**需求ID**：FR-ATHLETE-003

**优先级**：高（MUST）

**详细需求**：
1. **基本信息展示**：
   - 显示选手的所有基本信息（如4.2.2所列）
   - 信息以卡片形式清晰展示，符合瑞士设计风格

2. **参赛历史**：
   - 显示该选手参加过的所有赛事列表
   - 每条记录显示：赛事名称、日期、地点、参赛组别、成绩/排名（如有）
   - 点击赛事名称，跳转至对应赛事页面

3. **增值服务记录**：
   - 显示选手在各赛事中购买的增值服务（油彩、摄影、摄像等）
   - 以标签形式展示

4. **快速操作**：
   - 从选手详情页可直接"为该选手报名新赛事"
   - 点击按钮，弹出赛事选择器和报名表单

**验收标准**：
- 选手详情页正确显示所有信息
- 参赛历史列表正确显示
- 点击赛事名称可跳转至赛事页面
- 可从选手详情页直接报名新赛事

---

#### 4.2.4 删除选手

**功能描述**：删除选手记录。

**需求ID**：FR-ATHLETE-004

**优先级**：中（SHOULD）

**详细需求**：
1. **删除确认**：
   - 点击"删除选手"按钮
   - 弹出确认对话框："确定删除该选手吗？此操作不可撤销。"
   - 确认后删除选手记录

2. **级联删除**：
   - 删除选手时，同时删除该选手的所有报名记录
   - 如果选手已参加比赛并有成绩，建议**不允许删除**，仅支持"归档"

**验收标准**：
- 可成功删除选手记录
- 删除后，选手从列表中消失
- 如果选手有成绩记录，系统阻止删除并提示

---

### 4.3 赛事管理（模块3）

#### 4.3.1 赛事列表

**功能描述**：统一管理所有赛事，支持按年份、类型筛选。

**需求ID**：FR-EVENT-001

**优先级**：高（MUST）

**详细需求**：
1. **赛事列表页面**：
   - 系统设立**一级导航入口**："赛事管理"
   - 显示所有赛事的卡片列表
   - 每张卡片显示：赛事封面图、赛事名称、日期、地点、赛事类型、报名人数

2. **筛选功能**：
   - 支持按**年份**筛选（2026、2027等）
   - 支持按**赛事类型**筛选：新星联赛、自然赛、经典赛、年度总决赛
   - 支持按**状态**筛选：未开始、进行中、已结束

3. **排序功能**：
   - 默认按**日期降序**排列（最新赛事在前）
   - 支持按**报名人数**排序

**验收标准**：
- 可查看所有赛事列表
- 筛选和排序功能正常
- 赛事卡片显示正确信息

---

#### 4.3.2 创建/编辑赛事

**功能描述**：创建新赛事或编辑现有赛事信息。

**需求ID**：FR-EVENT-002

**优先级**：高（MUST）

**详细需求**：
1. **创建赛事**：
   - 点击"创建赛事"按钮
   - 弹出表单，输入以下信息：

   | 字段名 | 类型 | 是否必填 | 说明 |
   |--------|------|----------|------|
   | **赛事名称** | 文本 | 必填 | 如"2026北京新星联赛" |
   | **赛事类型** | 下拉 | 必填 | 新星联赛、自然赛、经典赛、年度总决赛（支持自定义） |
   | **日期** | 日期 | 必填 | 赛事举办日期 |
   | **地点** | 文本 | 必填 | 如"北京市朝阳区XXX体育馆" |
   | **封面图** | 图片上传 | 选填 | 支持上传jpg/png，最大5MB，推荐尺寸1200x630 |
   | **赛事描述** | 富文本 | 选填 | 支持富文本编辑器（加粗、斜体、列表等），类似微信公众号文章样式 |
   | **裁判信息** | 动态表单 | 选填 | 可添加多位裁判，每位裁判包含：姓名、职称、头像（可上传） |
   | **基准报名费** | 数字 | 必填 | 首个项目的报名费（单位：元） |
   | **兼项费用** | 数字 | 必填 | 每个额外项目的费用（单位：元） |

2. **封面图上传**：
   - 支持拖拽上传或点击选择
   - 上传后显示预览
   - 图片存储在云存储/本地存储

3. **裁判信息管理**：
   - 点击"添加裁判"按钮，动态添加裁判表单
   - 每位裁判可上传头像（可选）
   - 支持删除裁判

4. **编辑赛事**：
   - 点击赛事卡片，进入赛事详情页
   - 点击"编辑"按钮，修改赛事信息
   - 保存后更新数据库

**验收标准**：
- 可成功创建新赛事，所有必填字段验证通过
- 封面图上传正常，显示预览
- 裁判信息可动态添加/删除
- 可编辑赛事信息并保存

---

#### 4.3.3 赛事详情页

**功能描述**：查看赛事完整信息、管理参赛选手、启动计分模式。

**需求ID**：FR-EVENT-003

**优先级**：高（MUST）

**详细需求**：
1. **赛事信息展示**：
   - 显示赛事的所有基本信息（如4.3.2所列）
   - 显示裁判信息（头像 + 姓名 + 职称）
   - 显示报名统计：总报名人数、报名人次（含兼项）、总报名费

2. **参赛选手列表**：
   - 显示该赛事的所有参赛选手
   - 每条记录显示：号码牌、姓名、性别、参赛组别（"真实组别"列表）、报名费、增值服务
   - 支持按组别筛选选手

3. **操作按钮**：
   - **添加参赛选手**：跳转至报名流程（见4.4）
   - **编排秩序表**：跳转至秩序表管理（见4.5）
   - **启动计分模式**：跳转至实时计分界面（见4.6）
   - **导出报名表**：导出该赛事的报名表为xlsx文件
   - **数据分析**：跳转至数据分析页面，预选该赛事

**验收标准**：
- 赛事详情页正确显示所有信息
- 参赛选手列表正确显示
- 所有操作按钮功能正常

---

### 4.4 报名管理（模块4）

#### 4.4.1 组别体系定义

**功能描述**：系统预设三级组别体系，支持动态调整。

**需求ID**：FR-REGISTRATION-001

**优先级**：高（MUST）

**详细需求**：
1. **组别数据结构**：
   - **男子一级组别**：传统、古典、健体、男子运动模特
   - **男子二级组别**：首秀、新秀、少年、在校、青年、型男、大师、公开
   - **男子三级组别**：A、B、C、D、E、全场
   - **女子一级组别**：比基尼、形体、健康小姐、Fit Model、女子运动模特、女子健身模特、女子女神模特
   - **女子二级组别**：首秀、新秀、少年、在校、青年、辣妈、公开
   - **女子三级组别**：A、B、C、D、E、全场

2. **"真实组别"生成逻辑**：
   - 真实组别 = **一级组别 + 二级组别 + 三级组别**
   - 示例：
     - 男子 + 青年 + 传统 + E = **"青年传统E"**（男子）
     - 女子 + 辣妈 + 比基尼 + C = **"辣妈比基尼C"**（女子）
   - 系统在报名时动态组合，生成唯一的"真实组别"标识

3. **"全场"组别特殊规则**：
   - "全场"用于汇集各ABCDE组冠军进行最终对决
   - 系统在计分时自动识别各组冠军，将其加入对应"全场"名单
   - 示例：A获"青年古典A"第一名 → 自动加入"青年古典全场"

4. **组别管理（可选功能，第二阶段）**：
   - 管理员可在"系统设置"中添加/删除组别
   - 当前版本：组别数据硬编码在前端和后端

**验收标准**：
- 系统正确存储三级组别体系
- 报名时可正确组合生成"真实组别"
- "全场"组别逻辑正确（在计分模块验证）

---

#### 4.4.2 选手报名流程

**功能描述**：为选手报名参赛项目，支持兼项和增值服务。

**需求ID**：FR-REGISTRATION-002

**优先级**：高（MUST）

**详细需求**：
1. **报名入口（两种路径）**：
   - **路径A**：从赛事详情页 → 点击"添加参赛选手" → 选择选手（支持搜索）→ 填写报名信息
   - **路径B**：从选手详情页 → 点击"为该选手报名新赛事" → 选择赛事 → 填写报名信息

2. **报名表单**：
   | 字段名 | 类型 | 是否必填 | 说明 |
   |--------|------|----------|------|
   | **选手** | 选择器 | 必填 | 从现有选手中选择（支持搜索），或"创建新选手" |
   | **参赛组别** | 多选 | 必填 | 可选择多个"真实组别"（兼项） |
   | **增值服务** | 复选框组 | 选填 | 油彩、摄影、摄像、化妆、提亮等 |
   | **摄影/摄像指定组别** | 下拉 | 条件必填 | 如选择了摄影或摄像，需指定拍摄哪个组别 |
   | **备注** | 文本域 | 选填 | 额外信息 |

3. **参赛组别选择器**：
   - **步骤1**：选择性别（男/女）→ 显示对应一级组别
   - **步骤2**：选择一级组别 → 显示对应二级组别
   - **步骤3**：选择二级组别 → 显示对应三级组别
   - **步骤4**：选择三级组别 → 生成"真实组别"（如"青年传统E"）
   - **步骤5**：点击"添加"按钮，将该组别加入已选列表
   - **步骤6**：重复上述步骤，添加多个组别（兼项）

4. **费用自动计算**：
   - **首项费用** = 基准报名费
   - **兼项费用** = 兼项数量 × 兼项单价
   - **增值服务费用** = 各服务价格之和（服务价格在系统设置中预设）
   - **总费用** = 首项费用 + 兼项费用 + 增值服务费用
   - 实时显示在表单底部

5. **摄影/摄像组别指定**：
   - 如选手报名多个组别，且购买了摄影或摄像服务
   - 需从已选组别中指定拍摄哪个组别
   - 摄影和摄像也区分首项和兼项定价

6. **增值服务标签**：
   - 系统记录选手购买的增值服务
   - 支持按服务类型筛选选手（如"查看所有购买摄影服务的选手"）

**验收标准**：
- 两种报名路径均正常工作
- 组别选择器正确显示并生成"真实组别"
- 费用自动计算准确
- 可成功为选手报名单个或多个组别
- 增值服务记录正确

---

#### 4.4.3 报名信息编辑与删除

**功能描述**：修改或删除选手的报名信息。

**需求ID**：FR-REGISTRATION-003

**优先级**：中（SHOULD）

**详细需求**：
1. **编辑报名**：
   - 在赛事详情页或选手详情页，点击"编辑报名"按钮
   - 可修改参赛组别、增值服务
   - 费用自动重新计算

2. **删除报名**：
   - 点击"删除报名"按钮
   - 弹出确认对话框
   - 确认后删除该选手的报名记录

**验收标准**：
- 可成功编辑报名信息
- 费用重新计算准确
- 可成功删除报名记录

---

### 4.5 秩序表管理（模块5）

#### 4.5.1 秩序表自动生成

**功能描述**：根据报名信息自动生成初始秩序表。

**需求ID**：FR-LINEUP-001

**优先级**：高（MUST）

**详细需求**：
1. **秩序表生成逻辑**：
   - 赛事创建完成且有选手报名后，点击"编排秩序表"按钮
   - 系统自动按以下规则生成初始秩序表：
     - 按"真实组别"分组
     - 同一"真实组别"的选手排列在一起
     - 默认按**号码牌升序**排列
     - 每个组别作为一个独立单元

2. **秩序表数据结构**：
   - 每一行代表一个选手在某个组别的出场
   - 字段：序号、号码牌、姓名、真实组别、是否展示、是否退赛

3. **兼项选手特殊处理**：
   - 如果选手A报名了"青年古典A"和"公开古典A"（同一一级组别）
   - 系统仅保留**一次展示机会**（默认在第一个出现的组别）
   - 未展示的项目以**灰色背景**标记，提示该选手在此组别不单独展示
   - 未展示项目的选手自动排在该组别队尾

**验收标准**：
- 秩序表自动生成正确
- 按组别分组，按号码牌排序
- 兼项选手正确标记未展示项目

---

#### 4.5.2 秩序表可视化编辑

**功能描述**：通过拖拽界面调整选手出场顺序。

**需求ID**：FR-LINEUP-002

**优先级**：高（MUST）

**详细需求**：
1. **界面设计**：
   - 秩序表以**类似表格**的形式展示（非真实WPS表格，但视觉类似）
   - 每一行代表一个选手
   - 列：序号、号码牌、姓名、真实组别、操作

2. **拖拽功能**：
   - 长按某一行（移动端）或点击拖拽图标（桌面端）
   - 拖动该行至目标位置
   - 释放后，自动重新编号
   - 使用 **@dnd-kit** 库实现拖拽

3. **组别合并**：
   - 选择多个相邻组别（如"青年古典A"、"青年古典B"、"青年古典C"）
   - 点击"合并为一个出场单元"按钮
   - 合并后，这些组别在视觉上以**外边框高亮**标识（如红色边框）
   - 合并的组别在计分时仍分别计分

4. **手动调整**：
   - 支持手动修改序号（输入新序号后，自动重新排列）
   - 支持"插入空行"（用于分隔不同组别）

**验收标准**：
- 拖拽功能流畅，无卡顿
- 拖动后序号自动更新
- 组别合并正确，外边框高亮显示
- 手动调整序号正常工作

---

#### 4.5.3 秩序表导出

**功能描述**：导出秩序表为xlsx文件。

**需求ID**：FR-LINEUP-003

**优先级**：高（MUST）

**详细需求**：
1. **导出按钮**：
   - 在秩序表页面顶部，显示"导出秩序表"按钮
   - 点击后弹出导出选项

2. **导出选项**：
   - **选择字段**：勾选要导出的字段（序号、号码牌、姓名、真实组别、身份证号等）
   - **隐藏敏感信息**：提供"隐藏身份证号"复选框，勾选后身份证号显示为"********"
   - **格式选择**：xlsx（默认）

3. **导出文件**：
   - 文件名：`秩序表_赛事名称_日期.xlsx`
   - 兼容WPS表格和Microsoft Excel
   - 使用 **SheetJS (xlsx)** 库生成

**验收标准**：
- 点击导出按钮，成功下载xlsx文件
- 导出的文件可在WPS表格和Excel中正常打开
- 隐藏敏感信息功能正常
- 可自定义选择导出字段

---

### 4.6 实时计分系统（模块6）

#### 4.6.1 计分模式启动

**功能描述**：进入实时计分界面，基于秩序表显示选手。

**需求ID**：FR-SCORING-001

**优先级**：高（MUST）

**详细需求**：
1. **启动入口**：
   - 在赛事详情页，点击"启动计分模式"按钮
   - 系统检查秩序表是否已编排，如未编排，提示"请先编排秩序表"

2. **计分界面布局**：
   - **左侧**：按秩序表顺序显示选手列表（可滚动）
   - **右侧**：当前选中选手的计分表

3. **裁判列设置**：
   - 进入计分模式前，弹出对话框："请选择裁判人数（1-7人）"
   - 确认后，计分表显示对应数量的裁判列

4. **计分表结构**：
   | 号码牌 | 姓名 | 真实组别 | 裁判1 | 裁判2 | ... | 裁判7 | 总分 | 排名 |
   |--------|------|----------|-------|-------|-----|-------|------|------|
   | 001 | 张三 | 青年传统E | [输入] | [输入] | ... | [输入] | [自动] | [自动] |

**验收标准**：
- 可成功启动计分模式
- 裁判人数设置正确
- 计分表正确显示秩序表中的选手

---

#### 4.6.2 裁判评分输入

**功能描述**：为每位选手输入裁判评分。

**需求ID**：FR-SCORING-002

**优先级**：高（MUST）

**详细需求**：
1. **评分输入**：
   - 根据健美比赛规则，裁判按选手应得排名打分：第一名得1分，第二名得2分，以此类推
   - 每个单元格为数字输入框，支持键盘输入
   - 输入范围：1-999（根据参赛人数调整）
   - 支持Tab键快速切换至下一个输入框

2. **自动保存**：
   - 输入后自动保存（防止意外关闭页面丢失数据）
   - 每次输入后，数据写入本地缓存和数据库

3. **撤销功能**：
   - 支持 **Ctrl+Z** 撤销上一次输入
   - 支持点击"撤销"按钮
   - 最多撤销10步

**验收标准**：
- 可正常输入裁判评分
- Tab键切换输入框正常
- 自动保存功能正常
- 撤销功能正常（Ctrl+Z 和按钮）

---

#### 4.6.3 自动计算与排名

**功能描述**：去极值、计算总分、自动排名、同分高亮。

**需求ID**：FR-SCORING-003

**优先级**：高（MUST）

**详细需求**：
1. **计算触发**：
   - 输入完所有裁判评分后，点击"计算"按钮或按 **Enter** 键
   - 系统自动执行计算

2. **计算规则**（符合IFBB健美比赛规则）：
   - 对于5或7位裁判，去掉一个最高分和一个最低分；对于9位裁判，去掉两个最高分和两个最低分
   - 将剩余分数相加，得到**总分**
   - 分数越低排名越高（1分最好）
   - 按总分**升序**排列，得到排名

3. **同分处理**：
   - 如果多位选手总分相同，这些选手的行以**红色背景高亮**
   - 系统提示："存在同分选手，请裁判进行额外评判"

4. **实时更新**：
   - 计算完成后，实时更新表格中的"总分"和"排名"列
   - 表格自动按排名重新排序

**验收标准**：
- 点击"计算"按钮或按Enter键，正确执行计算
- 去极值逻辑正确（5/7/9位裁判规则）
- 排名正确（按总分升序）
- 同分选手红色高亮显示

---

#### 4.6.4 冠军自动识别与"全场"名单生成

**功能描述**：自动识别各组冠军，加入对应"全场"项目。

**需求ID**：FR-SCORING-004

**优先级**：高（MUST）

**详细需求**：
1. **冠军识别**：
   - 计算完成后，系统自动识别每个"真实组别"的排名第一的选手
   - 标记为该组冠军

2. **"全场"名单生成**：
   - 提取冠军的"一级组别 + 二级组别"（如"青年古典"）
   - 将该选手自动加入"青年古典全场"名单
   - 示例：
     - A获"青年古典A"第一名 → 加入"青年古典全场"
     - B获"青年古典B"第一名 → 加入"青年古典全场"
     - C获"青年古典C"第一名 → 加入"青年古典全场"

3. **"全场"计分**：
   - "全场"项目作为一个新的计分单元
   - 裁判重新为"全场"选手打分
   - 按相同规则计算排名

**验收标准**：
- 各组冠军自动识别正确
- "全场"名单自动生成
- 可为"全场"项目单独计分

---

#### 4.6.5 退赛标记

**功能描述**：标记选手为"退赛"状态。

**需求ID**：FR-SCORING-005

**优先级**：中（SHOULD）

**详细需求**：
1. **标记退赛**：
   - 在计分表中，选手行右侧显示"标记退赛"按钮
   - 点击后，该选手的整行变为**灰色背景**
   - 裁判评分单元格变为不可编辑状态

2. **退赛选手处理**：
   - 退赛选手不参与排名计算
   - 在最终成绩表中标注"退赛"

**验收标准**：
- 可成功标记选手为退赛
- 退赛选手行变为灰色
- 退赛选手不参与排名

---

#### 4.6.6 计分结果导出

**功能描述**：导出计分结果表为xlsx文件。

**需求ID**：FR-SCORING-006

**优先级**：高（MUST）

**详细需求**：
1. **导出按钮**：
   - 在计分页面顶部，显示"导出计分表"按钮
   - 点击后弹出导出选项

2. **导出选项**：
   - **选择字段**：勾选要导出的字段（号码牌、姓名、真实组别、各裁判评分、总分、排名）
   - **隐藏敏感信息**：提供"隐藏身份证号"复选框
   - **格式选择**：xlsx（默认）

3. **导出文件**：
   - 文件名：`计分表_赛事名称_组别_日期.xlsx`
   - 每个"真实组别"导出为单独的Sheet
   - 使用 **SheetJS (xlsx)** 库生成

**验收标准**：
- 点击导出按钮，成功下载xlsx文件
- 导出的文件可在WPS表格和Excel中正常打开
- 每个组别单独一个Sheet
- 可自定义选择导出字段

---

### 4.7 数据分析（模块7）

#### 4.7.1 数据分析入口

**功能描述**：统一的数据分析页面，支持单场或多场赛事分析。

**需求ID**：FR-ANALYTICS-001

**优先级**：高（MUST）

**详细需求**：
1. **数据分析页面**：
   - 系统设立**一级导航入口**："数据分析"
   - 页面顶部显示赛事选择器：
     - 单选：选择某一场赛事
     - 多选：选择多场赛事（按住Ctrl/Cmd多选）
     - 全选：分析所有赛事

2. **筛选条件**：
   - 支持自由组合筛选条件：
     - **性别**：男/女
     - **国籍**：中国大陆、中国台湾、中国香港等
     - **年龄段**：少年（<18）、青年（18-35）、大师（>35）等（可自定义）
     - **一级组别**：传统、古典、健体等
     - **二级组别**：首秀、新秀、青年、公开等
     - **三级组别**：A、B、C、D、E、全场
   - 筛选条件以**标签形式**展示，点击添加/移除
   - 示例："中国大陆 + 青年组 + 男性"

**验收标准**：
- 可选择单场或多场赛事
- 筛选条件正常工作
- 筛选后数据实时更新

---

#### 4.7.2 基础统计指标

**功能描述**：展示核心统计数据。

**需求ID**：FR-ANALYTICS-002

**优先级**：高（MUST）

**详细需求**：
1. **核心指标**（以卡片形式展示）：
   - **总报名人数**（去重）：有多少位不同的选手参赛
   - **总报名人次**（含兼项）：所有报名记录的总数（一人报多项算多次）
   - **平均兼项数**：总报名人次 ÷ 总报名人数
   - **人均消费金额**：总报名费（含增值服务） ÷ 总报名人数

2. **统计图表位置**：
   - 核心指标卡片位于页面顶部
   - 图表位于下方

**验收标准**：
- 核心指标计算准确
- 卡片清晰展示数据
- 数据随筛选条件实时更新

---

#### 4.7.3 数据可视化（饼图）

**功能描述**：以饼图形式展示多维度数据分布。

**需求ID**：FR-ANALYTICS-003

**优先级**：高（MUST）

**详细需求**：
1. **饼图类型**：
   - **性别分布**：男性 vs 女性
   - **国籍分布**：中国大陆、中国台湾、中国香港、其他国家
   - **年龄分布**：少年、青年、大师等年龄段
   - **一级组别分布**：各一级组别的报名人次
   - **二级组别分布**：各二级组别的报名人次
   - **三级组别分布**：各三级组别的报名人次
   - **增值服务分布**：各增值服务的购买率

2. **饼图样式**：
   - 使用 **Recharts** 库绘制
   - 饼图位于左侧，文字说明位于右侧
   - 颜色：红蓝配色（符合品牌色）
   - 支持鼠标悬停显示详细数据

3. **交互功能**：
   - 点击饼图某一扇区，自动添加该条件到筛选器
   - 示例：点击"中国大陆"扇区 → 自动筛选出中国大陆选手

**验收标准**：
- 所有饼图正确显示
- 饼图数据准确
- 交互功能正常（点击扇区添加筛选）

---

#### 4.7.4 高级分析

**功能描述**：展示更深层次的数据洞察。

**需求ID**：FR-ANALYTICS-004

**优先级**：中（SHOULD）

**详细需求**：
1. **组别偏好分析**：
   - 不同性别偏好的一级组别（如"男性最爱传统，女性最爱比基尼"）
   - 不同年龄段偏好的二级组别（如"青年组最多，少年组最少"）

2. **组别占比分析**：
   - 二级组别占一级组别的比例（如"青年组占传统项目的40%"）
   - 三级组别占二级组别的比例（如"A组占青年组的30%"）

3. **趋势分析**（多场赛事）：
   - 不同赛事的报名人数趋势（折线图）
   - 不同赛事的人均消费趋势（折线图）

4. **Top榜单**：
   - 参赛次数最多的选手Top 10
   - 消费金额最高的选手Top 10

**验收标准**：
- 高级分析数据准确
- 图表清晰展示
- 支持导出分析报告（可选）

---

### 4.8 积分系统（模块8，第二阶段）

**功能描述**：管理年度积分排名，决定总决赛参赛资格。

**需求ID**：FR-POINTS-001

**优先级**：低（MAY，第二阶段开发）

**详细需求**：
1. **积分规则设置**：
   - 管理员可在"系统设置"中配置积分规则
   - 示例规则：第1名=10分，第2名=8分，第3名=6分，第4-6名=4分，参赛=1分
   - 不同赛事类型可设置不同权重（如总决赛权重×2）

2. **积分自动计算**：
   - 赛事结束后，系统根据排名自动为选手计算积分
   - 积分累加至选手的年度总积分

3. **积分榜**：
   - 显示年度积分排名（总榜、男子榜、女子榜、各组别榜）
   - 支持按年份筛选

4. **总决赛资格**：
   - 达到积分门槛的选手自动获得总决赛参赛资格
   - 积分门槛由管理员设置

**验收标准**：
- 积分规则可配置
- 积分自动计算准确
- 积分榜正确显示

---

## 5. 数据库设计要求

### 5.1 数据模型（MongoDB Collections）

#### 5.1.1 用户集合（Users）

```typescript
{
  _id: ObjectId,
  username: string,        // 用户名
  password: string,        // 加密后的密码（bcrypt）
  role: string,           // 'super_admin' | 'admin'
  name: string,           // 真实姓名
  token: string,          // 私有Token（仅超级管理员）
  createdAt: Date,
  updatedAt: Date
}
```

#### 5.1.2 选手集合（Athletes）

```typescript
{
  _id: ObjectId,
  name: string,              // 姓名
  gender: string,            // 'male' | 'female'
  bib_number: string,        // 号码牌（唯一）
  phone: string,             // 手机号（唯一）
  nationality: string,       // 国籍
  id_type: string,           // 证件类型
  id_number: string,         // 证件号
  birthdate: Date,           // 生日
  age: number,               // 年龄（自动计算）
  height: number,            // 身高（cm）
  weight: number,            // 体重（kg）
  drug_test: boolean,        // 是否尿检
  registration_channel: string, // 报名渠道
  notes: string,             // 备注
  createdAt: Date,
  updatedAt: Date
}
```

#### 5.1.3 赛事集合（Events）

```typescript
{
  _id: ObjectId,
  name: string,              // 赛事名称
  type: string,              // 赛事类型
  date: Date,                // 日期
  location: string,          // 地点
  cover_image: string,       // 封面图URL
  description: string,       // 富文本描述
  judges: [                  // 裁判信息
    {
      name: string,
      title: string,
      avatar: string
    }
  ],
  base_fee: number,          // 基准报名费
  additional_fee: number,    // 兼项费用
  status: string,            // 'upcoming' | 'ongoing' | 'finished'
  createdAt: Date,
  updatedAt: Date
}
```

#### 5.1.4 报名集合（Registrations）

```typescript
{
  _id: ObjectId,
  event_id: ObjectId,        // 关联赛事
  athlete_id: ObjectId,      // 关联选手
  categories: [              // 参赛组别（真实组别）
    {
      level1: string,        // 一级组别
      level2: string,        // 二级组别
      level3: string,        // 三级组别
      display_name: string,  // 组合名称（如"青年传统E"）
      is_primary: boolean    // 是否为首项
    }
  ],
  services: [                // 增值服务
    {
      service_type: string,  // 'paint' | 'photo' | 'video' | 'makeup' | 'glow'
      category: string,      // 指定组别（仅摄影/摄像）
      price: number
    }
  ],
  total_fee: number,         // 总费用
  notes: string,             // 备注
  createdAt: Date,
  updatedAt: Date
}
```

#### 5.1.5 秩序表集合（Lineups）

```typescript
{
  _id: ObjectId,
  event_id: ObjectId,        // 关联赛事
  lineup: [                  // 秩序列表
    {
      order: number,         // 序号
      athlete_id: ObjectId,
      category: string,      // 真实组别
      is_display: boolean,   // 是否展示（兼项处理）
      is_retired: boolean,   // 是否退赛
      group_id: string       // 合并组别ID（可选）
    }
  ],
  merged_groups: [           // 合并的组别
    {
      group_id: string,
      categories: [string]
    }
  ],
  createdAt: Date,
  updatedAt: Date
}
```

#### 5.1.6 计分集合（Scores）

```typescript
{
  _id: ObjectId,
  event_id: ObjectId,        // 关联赛事
  category: string,          // 真实组别
  athlete_id: ObjectId,
  judge_scores: [number],    // 各裁判评分
  total_score: number,       // 总分（去极值后）
  rank: number,              // 排名
  is_champion: boolean,      // 是否冠军
  is_retired: boolean,       // 是否退赛
  createdAt: Date,
  updatedAt: Date
}
```

### 5.2 数据库索引

为提升查询性能，需创建以下索引：

```javascript
// Athletes集合
db.athletes.createIndex({ "phone": 1 }, { unique: true })
db.athletes.createIndex({ "bib_number": 1 }, { unique: true })
db.athletes.createIndex({ "name": 1 })

// Events集合
db.events.createIndex({ "date": -1 })
db.events.createIndex({ "type": 1 })

// Registrations集合
db.registrations.createIndex({ "event_id": 1, "athlete_id": 1 })
db.registrations.createIndex({ "athlete_id": 1 })

// Scores集合
db.scores.createIndex({ "event_id": 1, "category": 1, "rank": 1 })
```

---

## 6. 非功能性需求

### 6.1 性能需求

| 指标 | 要求 |
|------|------|
| **页面加载时间** | 首屏加载 < 2秒（4G网络） |
| **API响应时间** | 90%的请求 < 500ms |
| **并发用户** | 支持50个管理员同时在线 |
| **数据容量** | 支持10,000+选手、100+赛事、100,000+报名记录 |
| **计分实时性** | 输入后 < 100ms 显示结果 |

### 6.2 安全需求

1. **身份认证**：
   - 所有API请求必须携带有效JWT Token
   - Token有效期7天，过期自动跳转登录页
   - 密码使用bcrypt加密（盐轮数=10）

2. **数据验证**：
   - 所有用户输入必须经过前后端双重验证
   - 防止SQL注入（虽然使用MongoDB，但仍需防NoSQL注入）
   - 防止XSS攻击（富文本编辑器使用DOMPurify清理）

3. **权限控制**：
   - 超级管理员独有权限：管理其他管理员
   - 普通管理员：所有业务功能权限
   - API层面验证用户角色

4. **数据备份**：
   - 数据库每日自动备份
   - 备份保留30天

### 6.3 可用性需求

1. **浏览器兼容性**：
   - Chrome 100+
   - Safari 15+
   - Edge 100+
   - Firefox 100+

2. **设备兼容性**：
   - 桌面：Windows、macOS、Linux
   - 移动：iOS 14+、Android 10+
   - 平板：iPad、Android平板

3. **响应式设计**：
   - 断点：
     - 移动端：< 640px
     - 平板：640px - 1024px
     - 桌面：> 1024px
   - 所有页面自适应布局

4. **离线支持（可选，第二阶段）**：
   - 计分模式支持离线使用（本地缓存数据）
   - 恢复网络后自动同步

### 6.4 可维护性需求

1. **代码规范**：
   - 使用ESLint + Prettier统一代码风格
   - TypeScript严格模式（strict: true）
   - 变量/函数命名清晰，遵循驼峰命名法

2. **文档**：
   - README.md：项目说明、安装步骤、启动命令
   - API文档：使用Swagger/OpenAPI自动生成
   - 代码注释：关键逻辑添加注释

3. **测试（可选，第二阶段）**：
   - 单元测试：关键函数覆盖率 > 70%
   - 集成测试：核心流程测试

### 6.5 可扩展性需求

1. **模块化设计**：
   - 前端：按功能模块拆分组件
   - 后端：按业务逻辑拆分路由和控制器

2. **配置化**：
   - 组别体系、费用规则、积分规则等可在配置文件中调整
   - 避免硬编码

3. **国际化（可选，第二阶段）**：
   - 支持中英文切换
   - 使用i18n库

---

## 7. 外部接口需求

### 7.1 RESTful API设计

#### 7.1.1 认证接口

```
POST /api/auth/login
- 请求体：{ username, password/token }
- 响应：{ token, user: { id, name, role } }

POST /api/auth/logout
- 请求头：Authorization: Bearer <token>
- 响应：{ message: "Logged out successfully" }
```

#### 7.1.2 管理员接口

```
GET /api/admins
- 获取所有管理员列表（仅超级管理员）

POST /api/admins
- 创建新管理员（仅超级管理员）
- 请求体：{ name, username, password }

DELETE /api/admins/:id
- 删除管理员（仅超级管理员）
```

#### 7.1.3 选手接口

```
GET /api/athletes
- 获取选手列表
- 查询参数：?search=&gender=&nationality=

GET /api/athletes/:id
- 获取单个选手详情

POST /api/athletes
- 创建新选手
- 请求体：{ name, gender, bib_number, ... }

PUT /api/athletes/:id
- 更新选手信息

DELETE /api/athletes/:id
- 删除选手
```

#### 7.1.4 赛事接口

```
GET /api/events
- 获取赛事列表
- 查询参数：?year=&type=&status=

GET /api/events/:id
- 获取单个赛事详情

POST /api/events
- 创建新赛事
- 请求体：{ name, type, date, location, ... }

PUT /api/events/:id
- 更新赛事信息

DELETE /api/events/:id
- 删除赛事
```

#### 7.1.5 报名接口

```
POST /api/registrations
- 创建报名记录
- 请求体：{ event_id, athlete_id, categories, services }

GET /api/registrations?event_id=&athlete_id=
- 查询报名记录

PUT /api/registrations/:id
- 更新报名信息

DELETE /api/registrations/:id
- 删除报名
```

#### 7.1.6 秩序表接口

```
GET /api/lineups/:event_id
- 获取赛事秩序表

POST /api/lineups/:event_id/generate
- 自动生成秩序表

PUT /api/lineups/:event_id
- 更新秩序表（拖拽后保存）
- 请求体：{ lineup: [...] }

GET /api/lineups/:event_id/export
- 导出秩序表为xlsx
```

#### 7.1.7 计分接口

```
GET /api/scores/:event_id
- 获取赛事所有计分记录

POST /api/scores
- 创建/更新计分记录
- 请求体：{ event_id, athlete_id, category, judge_scores }

POST /api/scores/:event_id/calculate
- 触发自动计算排名

GET /api/scores/:event_id/export
- 导出计分表为xlsx
```

#### 7.1.8 数据分析接口

```
GET /api/analytics/summary
- 获取核心统计指标
- 查询参数：?event_ids[]=&gender=&nationality=

GET /api/analytics/charts
- 获取图表数据（饼图、折线图）
- 查询参数：?chart_type=&filters=
```

### 7.2 文件上传接口

```
POST /api/upload/image
- 上传图片（封面图、头像）
- 请求体：multipart/form-data
- 响应：{ url: "https://..." }

支持格式：jpg, png
最大文件大小：5MB
```

### 7.3 错误响应格式

所有API错误响应遵循统一格式：

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "用户友好的错误信息",
    "details": {} // 可选，详细错误信息
  }
}
```

常见错误码：
- `AUTH_FAILED`：认证失败
- `PERMISSION_DENIED`：权限不足
- `VALIDATION_ERROR`：数据验证失败
- `NOT_FOUND`：资源不存在
- `DUPLICATE_ENTRY`：重复记录（如手机号重复）
- `SERVER_ERROR`：服务器内部错误

---

## 8. 用户界面需求

### 8.1 设计风格：瑞士设计（Swiss Design Style）

**核心原则**：
1. **极简主义**：去除一切不必要的装饰，专注内容本身
2. **网格布局**：使用严格的网格系统组织元素
3. **无衬线字体**：使用现代无衬线字体（如Inter、Helvetica）
4. **留白**：大量使用留白，增强可读性
5. **色彩克制**：主要使用黑白灰，品牌色作为点缀

**参考网站**：
- 苹果官网：https://www.apple.com
- 一加官网：https://www.oneplus.com

### 8.2 配色方案

**主色调**：
- **红色**：#E63946（热情、活力）
- **蓝色**：#1D3557（专业、稳重）
- **黑色**：#000000（经典、有力）
- **白色**：#FFFFFF（纯净、简洁）

**辅助色**：
- **灰色1**：#F8F9FA（背景色）
- **灰色2**：#6C757D（次要文字）
- **灰色3**：#DEE2E6（边框、分割线）

**功能色**：
- **成功**：#28A745（绿色）
- **警告**：#FFC107（黄色）
- **错误**：#DC3545（红色）
- **信息**：#17A2B8（青色）

### 8.3 字体

- **英文/数字**：Inter（Google Fonts）
- **中文**：思源黑体（Noto Sans SC）或系统默认（-apple-system, "Segoe UI"）

### 8.4 组件规范

#### 8.4.1 按钮

- **主按钮**：红色背景 + 白色文字
- **次按钮**：蓝色背景 + 白色文字
- **文本按钮**：无背景，蓝色文字
- **圆角**：6px
- **高度**：40px（桌面）/ 44px（移动）

#### 8.4.2 表单

- **输入框**：
  - 边框：1px solid #DEE2E6
  - 聚焦时：边框变为蓝色，显示阴影
  - 圆角：4px
  - 高度：40px

- **下拉菜单**：使用Shadcn/ui的Select组件

- **日期选择器**：使用Shadcn/ui的DatePicker组件

#### 8.4.3 表格

- **表头**：灰色背景（#F8F9FA）+ 粗体文字
- **行高**：48px
- **悬停效果**：行背景变为浅灰色
- **边框**：1px solid #DEE2E6

#### 8.4.4 卡片

- **背景**：白色
- **边框**：1px solid #DEE2E6
- **圆角**：8px
- **阴影**：0 2px 4px rgba(0,0,0,0.1)

### 8.5 响应式布局

#### 8.5.1 导航栏

- **桌面端**：
  - 顶部固定导航栏
  - Logo + 导航链接（选手管理、赛事管理、数据分析）+ 用户菜单

- **移动端**：
  - 汉堡菜单（点击展开侧边栏）
  - 侧边栏：导航链接竖向排列

#### 8.5.2 列表页

- **桌面端**：表格视图
- **平板/移动端**：卡片视图（竖向堆叠）

#### 8.5.3 表单页

- **桌面端**：双列布局（左右各50%）
- **平板/移动端**：单列布局（100%宽度）

### 8.6 交互反馈

1. **加载状态**：
   - 按钮点击后显示Loading图标
   - 页面加载时显示骨架屏（Skeleton）

2. **操作反馈**：
   - 成功：顶部显示绿色Toast提示
   - 失败：顶部显示红色Toast提示
   - 警告：弹出确认对话框

3. **表单验证**：
   - 实时验证：输入框失焦时验证
   - 错误提示：输入框下方显示红色错误文字

### 8.7 关键页面原型

#### 8.7.1 选手列表页

```
┌─────────────────────────────────────────────────────┐
│ Logo    选手管理  赛事管理  数据分析        用户 ▼  │
├─────────────────────────────────────────────────────┤
│                                                     │
│  选手管理                          [+ 添加选手]      │
│                                                     │
│  [搜索框]  [性别筛选▼]  [国籍筛选▼]                  │
│                                                     │
│  ┌───────────────────────────────────────────┐    │
│  │ 001  张三  男  138****1234  参赛3次  [查看]│    │
│  ├───────────────────────────────────────────┤    │
│  │ 002  李四  女  139****5678  参赛1次  [查看]│    │
│  └───────────────────────────────────────────┘    │
│                                                     │
│  [1] [2] [3] ... [10]                              │
│                                                     │
└─────────────────────────────────────────────────────┘
```

#### 8.7.2 计分界面

```
┌─────────────────────────────────────────────────────┐
│  2026北京新星联赛 - 计分模式                          │
│  青年传统E组                          [导出计分表]    │
├─────────────────────────────────────────────────────┤
│                                                     │
│  号码牌 姓名  裁判1 裁判2 裁判3 裁判4 裁判5 总分 排名│
│  ──────────────────────────────────────────────────│
│  001   张三   [1]   [2]   [1]   [1]   [2]   5    1 │
│  002   李四   [2]   [1]   [2]   [2]   [1]   6    2 │
│  003   王五   [3]   [3]   [3]   [3]   [3]   12   3 │
│                                                     │
│  [计算排名]  [撤销]  [标记退赛]                       │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 9. 附录

### 9.1 术语表

| 术语 | 定义 |
|------|------|
| **真实组别** | 由一级、二级、三级组别组合而成的唯一参赛单元（如"青年传统E"） |
| **兼项** | 选手报名多个组别 |
| **首项** | 选手报名的第一个组别，费用为基准价 |
| **全场** | 汇集各ABCDE组冠军进行最终对决的特殊三级组别 |
| **去极值** | 去掉最高分和最低分，取剩余分数平均值 |
| **秩序表** | 赛事中选手的出场顺序安排 |
| **增值服务** | 油彩、摄影、摄像、化妆、提亮等附加服务 |

### 9.2 健美比赛计分规则参考

根据国际健美联合会（IFBB）规则：
1. 裁判按选手应得排名打分：第一名得1分，第二名得2分，以此类推
2. 对于5或7位裁判，去掉一个最高分和一个最低分
3. 分数越低排名越高
4. 如遇同分，优先比较决赛轮成绩，或进行额外评判

### 9.3 开发优先级

**第一阶段（MVP，2-3个月）**：
1. ✅ 认证系统（Token登录）
2. ✅ 选手管理（CRUD）
3. ✅ 赛事管理（CRUD）
4. ✅ 报名管理（组别组合、费用计算）
5. ✅ 秩序表管理（自动生成、拖拽编排、导出）
6. ✅ 实时计分（输入、计算、排名、导出）
7. ✅ 基础数据分析（核心指标、饼图）

**第二阶段（增强功能，1-2个月）**：
1. ⏳ 高级数据分析（趋势分析、Top榜单）
2. ⏳ 积分系统
3. ⏳ Flutter移动端开发
4. ⏳ 离线支持
5. ⏳ 国际化（中英文）

**第三阶段（优化与扩展，持续）**：
1. ⏳ Flutter桌面端开发
2. ⏳ 性能优化
3. ⏳ 单元测试与集成测试
4. ⏳ 手机验证码登录（如预算允许）

### 9.4 部署清单

**开发环境**：
- Node.js 20+
- MongoDB 7+
- Git

**生产环境**：
- 云服务器（2核4G起步，推荐4核8G）
- 操作系统：Ubuntu 22.04 LTS
- Docker + Docker Compose
- Nginx反向代理
- SSL证书（Let's Encrypt免费）
- 云存储（阿里云OSS / 本地存储）

**监控与日志**：
- PM2（Node.js进程管理）
- Winston（日志记录）
- MongoDB Compass（数据库管理工具）

### 9.5 联系方式

**项目负责人**：您本人
**开发团队**：Cursor + Gemini 3 Pro AI辅助开发
**技术支持**：待确定

---

## 结语

本软件需求规格说明书（SRS）详细定义了肌肉神话健美比赛管理系统的功能需求、技术架构、数据库设计、用户界面和非功能性需求。

**核心优势**：
1. ✅ **终极方案技术栈**：Next.js（Web）+ Flutter（移动/桌面）+ Node.js + MongoDB
2. ✅ **TypeScript一语到底**：前后端类型统一，避免通信断层
3. ✅ **真正的跨平台**：从Web到移动到桌面，一套后端API支撑所有平台
4. ✅ **瑞士设计风格**：简洁、现代、有力，符合健美运动美学
5. ✅ **业务逻辑完整**：覆盖报名、编排、计分、分析全流程

**下一步行动**：
1. 将本SRS发送给Cursor上的Gemini 3 Pro
2. 开始第一阶段开发（MVP）
3. 迭代测试，收集反馈
4. 在2026赛季前完成上线

祝肌肉神话健美比赛管理系统开发顺利！💪🏆

---

**文档版本**：1.0  
**最后更新**：2025年11月21日  
**状态**：待开发
[1] [Guide to Writing Software Requirements Specification (SRS)](https://www.modernrequirements.com/blogs/requirements-specification/)

[2] [How Bodybuilding Scoring Works — Understanding the Scorecards and Judging System | BarBend](https://barbend.com/how-scoring-in-bodybuilding-works/)

[3] [How Bodybuilding is Judged, Different Divisions, and Scoring | BarBend](https://barbend.com/how-bodybuilding-is-judged/)